var $TLDR="function"==typeof jQuery.noConflict?jQuery.noConflict(!0):jQuery;(function(k){k.fn.extend({scrollTo:function(n){if(n=k(this).offset()){n=n.top;var t=k(window).height()/3;400<t&&(t=200);k("html,body").animate({scrollTop:n-t},1E3)}return this}})})($TLDR);
(function(k){function n(t){var y=k(t)[0].tagName.toLowerCase(),q=[],u=[];q[0]="html body div span applet object iframe h1 h2 h3 h4 h5 h6 p blockquote pre a abbr acronym address big cite code del dfn em font img ins kbd q s samp small strike strong sub sup tt var b u i center dl dt dd ol ul li fieldset form label legend table caption tbody tfoot thead tr th td input".split(" ");var p={margin:"0",padding:"0",border:"0",outline:"0",fontSize:"100%",verticalAlign:"baseline",background:"transparent"};u[0]=
p;q[1]=["body"];p={lineHeight:"1"};u[1]=p;q[2]=["ol","ul"];p={listStyle:"none"};u[2]=p;q[3]=["blockquote","q"];p={quotes:"none"};u[3]=p;q[4]=["ins"];p={textDecoration:"none"};u[4]=p;q[5]=["del"];p={textDecoration:"line-through"};u[5]=p;q[6]=["table"];p={borderCollapse:"collapse",borderSpacing:"0"};u[6]=p;k(q).each(function(E){k(this).each(function(B){if(y==this)for(key in B=u[E],B)k(t).css(key,B[key])})})}k.fn.beResetCSS=function(){n(this);return this}})($TLDR);
var TLDR=function(k){function n(a){this.attr=a}function t(){this.attr="class"}function y(){this.attr="id"}function q(a){this.attr=a}function u(a){this.forceChildIndex=null===a?!1:a}function p(){}function E(){}function B(){}function I(){this.maxPaths=20;this.selectorHints=[new y,new n("name"),new t,new q("action"),new q("href"),new u,new p,new E,new B]}function N(a,b){b=b||[];var d=a.nodeType,c=a.childNodes,g=c.length,f=[d,a.nodeName,g].join(":"),e="";switch(d){case 3:d=a.nodeValue.replace(/</g,"&lt;").replace(/>/g,
"&gt;");break;case 8:d="\x3c!--"+a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"--\x3e";break;default:d="<"+f+">",e="</>"}d&&b.push(d);for(d=0;d<g;++d)N(c[d],b);e&&b.push(e);return b}function J(a,b,d){if(a)if(3==a.nodeType){if(-1!==a.data.indexOf(b)&&d(a))return a}else for(var c=a.firstChild;c;){a=c.nextSibling;if(c=J(c,b,d))return c;c=a}return null}function K(a){a=N(a).join("");return T(a).toString(16)}function O(a,b){var d=a,c=-1;1!=a.nodeType&&(c=rangy.dom.getNodeIndex(a),a=a.parentNode);
c={xpaths:(new I).generate(a),offset:b,checksum:K(a),nodeIndex:c};3==d.nodeType&&(d=d.data.trim(),20<d.length&&(d=d.substring(0,20).trim()),0<d.length&&(c.text=d));return c}function P(a,b,d){for(var c=null,g=a.offset,f=0;f<b.length&&!c;++f)for(var e=0;e<a.xpaths.length&&!c;++e){var h=F(b[f],a.xpaths[e],!0);if(1==h.length)try{K(h[0])==a.checksum&&(-1!=a.nodeIndex?a.nodeIndex<h[0].childNodes.length&&(c=h[0].childNodes[a.nodeIndex]):c=h[0])}catch(l){}}if(!c&&a.text){e=null;for(f=0;f<b.length&&!c;++f)(h=
b[f])&&h.documentElement&&(c=J(h.documentElement,a.text,function(l){return K(l.parentNode)==a.checksum}),e||c||(e=J(h.documentElement,a.text,function(l){return 0===l.data.trim().indexOf(a.text)?(g=d?a.text.length:0,!0):!1})));c||(c=e)}return null==c?null:new rangy.dom.DomPosition(c,g)}function U(a){a=a||rangy.getSelection();a=a.getAllRanges();var b=[];0==a.length&&(a=rangy.getSelection(),a=a.getAllRanges());for(var d=0,c=a.length;d<c;++d){var g=d,f=a[d],e=rangy.DomRange.getRangeDocument(f),h=O(f.startContainer,
f.startOffset,e);f=O(f.endContainer,f.endOffset,e);b[g]={start:h,end:f}}return b}function V(a,b){for(var d,c,g=0,f=a.length;g<f;++g){range=a[g];range.splitBoundaries();c=range.getNodes([3]);for(var e=0;e<c.length;++e){d=c[e];var h=d.ownerDocument.createElement("span");h.className=b;d.parentNode.insertBefore(h,d);h.appendChild(d)}}}function W(a){for(var b=[document],d=window.frames,c=0;c<d.length;c++)try{b.push(d[c].document)}catch(l){}d=[];c=0;for(var g=a.length;c<g;++c){var f=a[c],e=b;var h=P(f.start,
e);e=P(f.end,h?[h.node.ownerDocument]:e,!0);h||e?(h&&e?(f=rangy.createRange(h.node.ownerDocument),f.setStart(h.node,h.offset),f.setEnd(e.node,e.offset)):(e=h||e,f=rangy.createRange(e.node.ownerDocument),f.setStart(e.node,h?e.offset:0),f.setEnd(e.node,e.node.length)),h=f):h=null;null!=h&&d.push(h)}return d}function X(a){var b=k("<div id='tldr-message'><span>You are viewing content directed through <a href='//tldrify.com'>tldrify.com</a>. View the <a href='#'>original</a> page.</span></div>").beResetCSS().hide().appendTo("body");
b.find("a[href=#]").attr("href",a);k("<a href='#' id='tldr-close-notify'>X</a>").appendTo(b).click(function(d){d.preventDefault();k("#tldr-message").fadeOut("slow")});b.find("*").each(function(){k(this).beResetCSS()});b.find("a").css({color:"#fff","text-decoration":"underline"});b.css({"font-family":'"Lucida Grande", "Arial", "Helvetica", "Verdana", "sans-serif"',position:"fixed",top:"0px",left:"0px",width:"100%","z-index":"2147483640","text-align":"center","font-weight":"bold","font-size":"12px",
"line-height":"1em",color:"#fff",padding:"7px 0px 7px 0px","background-color":"#cf7721"});b.children("span").css({color:"#fff","text-align":"center",width:"95%","float":"left"});k("#tldr-close-notify").css({"white-space":"nowrap","float":"right","margin-right":"10px",color:"#fff","text-decoration":"none",border:"2px #fff solid","padding-left":"3px","padding-right":"3px"});b.fadeIn("slow")}function Y(){var a="";window.getSelection?a=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&
(a=document.selection.createRange().text);return a}var Q=/^[\w_\.\-]+$/;Q=/^[a-zA-Z_][a-zA-Z_\.\-]*[\d]*$/;var Z=/[AEIOUY]{4,}/i,aa=/[BCDFGHJKLMNPQRSTVWXY]{4,}/i;if("function"!=typeof F)var F=function(a,b){for(var d=[],c=document.evaluate(b,document,null,XPathResult.ANY_TYPE,null),g=c.iterateNext();g;)d.push(g),g=c.iterateNext();return d};var R=function(a){if(-1==a.indexOf("'"))return"'"+a+"'";if(-1==a.indexOf('"'))return'"'+a+'"';var b="concat(";a=a.split('"');for(var d=0;d<a.length;d++){var c=0<
d;""!=a[d]&&(0<d&&(b+=", "),b+='"'+a[d]+'"',c=!0);d<a.length-1&&(c&&(b+=", "),b+="'\"'")}return b+")"},S=function(a){for(var b=0,d=a.previousSibling;null!=d;)1==d.nodeType&&d.tagName==a.tagName&&++b,d=d.previousSibling;return b},L=function(a){return 3<a.length&&!a.match(aa)&&!a.match(Z)&&a.match(Q)};n.prototype.filterableByIndex=!0;n.prototype.generate=function(a){a=a.getAttribute(this.attr);return null!=a&&this.isValidValue(a)?"[@"+this.attr+"="+R(a)+"]":null};n.prototype.isValidValue=function(a){return 0<
a.length&&50>a.length};t.prototype=new n;t.prototype.constructor=t;t.prototype.isValidValue=function(a){var b=a.split(/[\s_\-]+/);if(4>a.length)return!1;if(1<b.length){for(var d=0,c=0;c<b.length;++c)L(b[c])&&++d;if(.5>d/b.length)return!1}else if(!L(a))return!1;return n.prototype.isValidValue.call(this,a)};y.prototype=new n;y.prototype.constructor=y;y.prototype.isValidValue=function(a){return L(a)?n.prototype.isValidValue.call(this,a):!1};q.prototype=new n;q.prototype.constructor=q;q.prototype.isValidValue=
function(a){return n.prototype.isValidValue.call(this,a)?0!=a.toLowerCase().indexOf("javascript:")&&"#"!=a:!1};u.prototype.generate=function(a){var b=S(a);if(!this.forceChildIndex){for(var d=0,c=a.nextSibling;null!=c;)1==c.nodeType&&c.tagName==a.tagName&&++d,c=c.nextSibling;if(0==b+d)return null}return"["+(b+1)+"]"};p.prototype.generate=function(a){if(0==S(a))return null;for(var b=a.nextSibling;null!=b;){if(1==b.nodeType&&b.tagName==a.tagName)return null;b=b.nextSibling}return"[last()]"};E.prototype.filterableByIndex=
!0;E.prototype.generate=function(a){for(var b=a.childNodes,d=b.length,c=0;c<d;++c)if(b[c]&&3!=b[c].nodeType)return null;a=a.textContent;return null!=a&&0<a.trim().length&&50>a.length?"[text()="+R(a)+"]":null};B.prototype.generate=function(a){for(var b=a.previousSibling;null!=b;){if(1==b.nodeType&&b.tagName==a.tagName)return null;b=b.previousSibling}for(b=a.nextSibling;null!=b;){if(1==b.nodeType&&b.tagName==a.tagName)return null;b=b.nextSibling}return""};I.prototype.generateAbsolute=function(a,b){for(var d=
new u(b),c="";null!=a;){if(1==a.nodeType){var g=d.generate(a);null==g&&(g="");c="/"+a.tagName.toLowerCase()+g+c}a=a.parentNode}return c};I.prototype.generate=function(a){for(var b=[],d=[""],c=a;null!=c&&0<d.length;){if(1==c.nodeType){for(var g=c,f=[],e=0;null!=g;){if(1==g.nodeType){var h=g.tagName.toLowerCase();if("body"==h)break;for(var l=0;l<this.selectorHints.length&&!(b.length>=this.maxPaths);++l){var z=this.selectorHints[l],C=z.generate(g);if(null!=C)for(var A=0;A<d.length&&!(b.length>=this.maxPaths);++A){var v=
d[A];if(!(0<e&&0==v.length||!z.filterableByIndex&&0<e&&0<v.length&&10<g.ownerDocument.getElementsByTagName(h).length)){var w=h+C+(0<e?"/":"")+v,m="//"+w,r=F(a.ownerDocument,m,0<e);if(1==r.length&&r[0]==a)b.push(m);else if(0==e){m=!1;for(var D=0;D<r.length;++D)if(a==r[D]){m=!0;break}if(m)if(z.filterableByIndex){w=h;r=C;m=a;D=b;for(var M=F(m.ownerDocument,"/descendant::"+w+r),G=0,H=0;H<M.length;++H){var x;a:{for(x=m;null!=x;){if(x==M[H]){x=!0;break a}x=x.parentNode}x=!1}if(x){G=H+1;break}}0<G&&(D.push("/descendant::"+
w+r+"["+G+"]"+v),G==M.snapshotLength&&D.push("/descendant::"+w+r+"[last()]"+v))}else f.push("/"+w)}}}}}g=g.parentNode;++e}d=f}c=c.parentNode}0==b.length&&b.push(this.generateAbsolute(a));return b};var T=function(){var a=null;return function(b){for(var d=[],c=0,g=b.length,f;c<g;++c)f=b.charCodeAt(c),128>f?d.push(f):2048>f?d.push(f>>6|192,f&63|128):d.push(f>>12|224,f>>6&63|128,f&63|128);b=-1;if(!a){c=[];g=0;for(var e;256>g;++g){e=g;for(f=8;f--;)e=1==(e&1)?e>>>1^3988292384:e>>>1;c[g]=e>>>0}a=c}c=a;g=
0;for(f=d.length;g<f;++g)e=(b^d[g])&255,b=b>>>8^c[e];return(b^-1)>>>0}}();return{save:function(a){a=void 0===a?!1:a;if(0<Y().trim().length){rangy.init();var b=U(),d=JSON.stringify(b),c=document.location.href;a?chrome.runtime.sendMessage({query:"createCitation",url:c,data:d},function(g){TLDR.restore(c,g.short_url,g.id,d,!0)}):k(function(){k.getScript("//tldrify.com/api/create.js?url="+encodeURIComponent(c)+"&data="+encodeURIComponent(d))})}else"undefined"!==typeof TLDR_spin&&TLDR_spin.hide()},restore:function(a,
b,d,c,g,f){g||"#noheader"==window.location.hash||X(a);try{rangy.init();"string"==typeof c&&(c=JSON.parse(c));var e=W(c),h="tldr-span"+(new Date).getTime();V(e,h)}finally{"undefined"!==typeof TLDR_spin&&TLDR_spin.hide()}k(function(){k("."+h+":first").scrollTo();document.getSelection().removeAllRanges();var l=k("."+h),z=0==l.length;if(!z){var C=function(){k("#tldr-iframe").css({display:"none"})},A=function(m,r){m-=92.5;r+=10;0==k("#tldr-iframe").length?k("body").append(k("<iframe>").attr("id","tldr-iframe").attr("src",
"//tldrify.com/sharebox?v20200106-2109&url="+encodeURIComponent(b)+"&title="+encodeURIComponent(v)).attr("width",210).attr("height",115).attr("frameborder",0).css({position:"absolute",overflow:"hidden","z-index":2147483647,top:r+"px",left:m+"px"})):k("#tldr-iframe").css({display:"",top:r+"px",left:m+"px"})},v=l.text();v=k.trim(v).replace(/\s+/," ");100<v.length&&(v=v.substring(0,100).replace(/[\S]*$/,"..."));l.css({"background-color":"yellow",color:"#333",cursor:"pointer"});l.each(function(){0<k(this).parent("a").length&&
k(this).css({"text-decoration":"underline"})});l.mouseenter(function(m){var r=m.clientX+k(window).scrollLeft();m=m.clientY+k(window).scrollTop();A(r,m)});k("body").on("click",C);k(document).bind("keydown",function(m){27==m.which&&C()});if(g){var w=l.offset().left+l.width()/2;l=l.offset().top+l.height();A(w,l)}else A(-1E3,-1E3)}g||z&&!f||k.ajax({type:"POST",url:"//tldrify.com/api/citation/"+d+"/view",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({xpath_failure:z})})})}}}($TLDR);
