var $TLDR="function"==typeof jQuery.noConflict?jQuery.noConflict(!0):jQuery;(function(d){d.fn.extend({scrollTo:function(l){if(l=d(this).offset()){l=l.top;var n=d(window).height()/3;400<n&&(n=200);d("html,body").animate({scrollTop:l-n},1E3)}return this}})})($TLDR);
(function(d){function l(l){var q=d(l)[0].tagName.toLowerCase(),m=[],p=[];m[0]="html body div span applet object iframe h1 h2 h3 h4 h5 h6 p blockquote pre a abbr acronym address big cite code del dfn em font img ins kbd q s samp small strike strong sub sup tt var b u i center dl dt dd ol ul li fieldset form label legend table caption tbody tfoot thead tr th td input".split(" ");var k={margin:"0",padding:"0",border:"0",outline:"0",fontSize:"100%",verticalAlign:"baseline",background:"transparent"};p[0]=
k;m[1]=["body"];k={lineHeight:"1"};p[1]=k;m[2]=["ol","ul"];k={listStyle:"none"};p[2]=k;m[3]=["blockquote","q"];k={quotes:"none"};p[3]=k;m[4]=["ins"];k={textDecoration:"none"};p[4]=k;m[5]=["del"];k={textDecoration:"line-through"};p[5]=k;m[6]=["table"];k={borderCollapse:"collapse",borderSpacing:"0"};p[6]=k;d(m).each(function(k){d(this).each(function(m){if(q==this)for(key in m=p[k],m)d(l).css(key,m[key])})})}d.fn.beResetCSS=function(){l(this);return this}})($TLDR);
var TLDR=function(d){function l(a){this.attr=a}function n(){this.attr="class"}function q(){this.attr="id"}function m(a){this.attr=a}function p(a){this.forceChildIndex=null===a?!1:a}function k(){}function w(){}function F(){}function B(){this.maxPaths=20;this.selectorHints=[new q,new l("name"),new n,new m("action"),new m("href"),new p,new k,new w,new F]}function G(a,b){b=b||[];var e=a.nodeType,c=a.childNodes,r=c.length,g=[e,a.nodeName,r].join(":"),f="",h="";switch(e){case 3:f=a.nodeValue.replace(/</g,
"&lt;").replace(/>/g,"&gt;");break;case 8:f="\x3c!--"+a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"--\x3e";break;default:f="<"+g+">",h="</>"}f&&b.push(f);for(e=0;e<r;++e)G(c[e],b);h&&b.push(h);return b}function C(a,b,e){if(a)if(3==a.nodeType){if(-1!==a.data.indexOf(b)&&e(a))return a}else for(var c=a.firstChild;c;){a=c.nextSibling;if(c=C(c,b,e))return c;c=a}return null}function D(a){a=G(a).join("");return M(a).toString(16)}function H(a,b){var e=a,c=-1;1!=a.nodeType&&(c=rangy.dom.getNodeIndex(a),
a=a.parentNode);c={xpaths:(new B).generate(a),offset:b,checksum:D(a),nodeIndex:c};3==e.nodeType&&(e=e.data.trim(),20<e.length&&(e=e.substring(0,20).trim()),0<e.length&&(c.text=e));return c}function I(a,b,e){for(var c=null,r=a.offset,g=0;g<b.length&&!c;++g)for(var f=0;f<a.xpaths.length&&!c;++f){var h=y(b[g],a.xpaths[f],!0);if(1==h.length)try{D(h[0])==a.checksum&&(-1!=a.nodeIndex?a.nodeIndex<h[0].childNodes.length&&(c=h[0].childNodes[a.nodeIndex]):c=h[0])}catch(d){}}if(!c&&a.text){f=null;for(g=0;g<
b.length&&!c;++g)(h=b[g])&&h.documentElement&&(c=C(h.documentElement,a.text,function(b){return D(b.parentNode)==a.checksum}),f||c||(f=C(h.documentElement,a.text,function(b){return 0===b.data.trim().indexOf(a.text)?(r=e?a.text.length:0,!0):!1})));c||(c=f)}return null==c?null:new rangy.dom.DomPosition(c,r)}function N(a){a=a||rangy.getSelection();a=a.getAllRanges();var b=[];0==a.length&&(a=rangy.getSelection(),a=a.getAllRanges());for(var e=0,c=a.length;e<c;++e){var r=e,g=a[e],f=rangy.DomRange.getRangeDocument(g),
h=H(g.startContainer,g.startOffset,f),g=H(g.endContainer,g.endOffset,f);b[r]={start:h,end:g}}return b}function O(a,b){for(var e,c,r=0,g=a.length;r<g;++r){range=a[r];range.splitBoundaries();c=range.getNodes([3]);for(var f=0;f<c.length;++f){e=c[f];var h=e.ownerDocument.createElement("span");h.className=b;e.parentNode.insertBefore(h,e);h.appendChild(e)}}}function P(a){for(var b=[document],e=window.frames,c=0;c<e.length;c++)try{b.push(e[c].document)}catch(r){}for(var e=[],c=0,g=a.length;c<g;++c){var f;
var h=a[c],d=b;f=I(h.start,d);d=I(h.end,f?[f.node.ownerDocument]:d,!0);f||d?(f&&d?(h=rangy.createRange(f.node.ownerDocument),h.setStart(f.node,f.offset),h.setEnd(d.node,d.offset)):(d=f||d,h=rangy.createRange(d.node.ownerDocument),h.setStart(d.node,f?d.offset:0),h.setEnd(d.node,d.node.length)),f=h):f=null;null!=f&&e.push(f)}return e}function Q(a){var b=d("<div id='tldr-message'><span>You are viewing content directed through <a href='//tldrify.com'>tldrify.com</a>. View the <a href='#'>original</a> page.</span></div>").beResetCSS().hide().appendTo("body");
b.find("a[href=#]").attr("href",a);d("<a href='#' id='tldr-close-notify'>X</a>").appendTo(b).click(function(a){a.preventDefault();d("#tldr-message").fadeOut("slow")});b.find("*").each(function(){d(this).beResetCSS()});b.find("a").css({color:"#fff","text-decoration":"underline"});b.css({"font-family":'"Lucida Grande", "Arial", "Helvetica", "Verdana", "sans-serif"',position:"fixed",top:"0px",left:"0px",width:"100%","z-index":"2147483640","text-align":"center","font-weight":"bold","font-size":"12px",
"line-height":"1em",color:"#fff",padding:"7px 0px 7px 0px","background-color":"#cf7721"});b.children("span").css({color:"#fff","text-align":"center",width:"95%","float":"left"});d("#tldr-close-notify").css({"white-space":"nowrap","float":"right","margin-right":"10px",color:"#fff","text-decoration":"none",border:"2px #fff solid","padding-left":"3px","padding-right":"3px"});b.fadeIn("slow")}function R(){var a="";window.getSelection?a=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&
(a=document.selection.createRange().text);return a}var J=/^[\w_\.\-]+$/,J=/^[a-zA-Z_][a-zA-Z_\.\-]*[\d]*$/,S=/[AEIOUY]{4,}/i,T=/[BCDFGHJKLMNPQRSTVWXY]{4,}/i;if("function"!=typeof y)var y=function(a,b){for(var e=[],c=document.evaluate(b,document,null,XPathResult.ANY_TYPE,null),d=c.iterateNext();d;)e.push(d),d=c.iterateNext();return e};var K=function(a){if(-1==a.indexOf("'"))return"'"+a+"'";if(-1==a.indexOf('"'))return'"'+a+'"';var b="concat(";a=a.split('"');for(var e=0;e<a.length;e++){var c=0<e;""!=
a[e]&&(0<e&&(b+=", "),b+='"'+a[e]+'"',c=!0);e<a.length-1&&(c&&(b+=", "),b+="'\"'")}return b+")"},L=function(a){for(var b=0,e=a.previousSibling;null!=e;)1==e.nodeType&&e.tagName==a.tagName&&++b,e=e.previousSibling;return b},E=function(a){return 3<a.length&&!a.match(T)&&!a.match(S)&&a.match(J)};l.prototype.filterableByIndex=!0;l.prototype.generate=function(a){a=a.getAttribute(this.attr);return null!=a&&this.isValidValue(a)?"[@"+this.attr+"="+K(a)+"]":null};l.prototype.isValidValue=function(a){return 0<
a.length&&50>a.length};n.prototype=new l;n.prototype.constructor=n;n.prototype.isValidValue=function(a){var b=a.split(/[\s\_\-]+/);if(4>a.length)return!1;if(1<b.length){for(var e=0,c=0;c<b.length;++c)E(b[c])&&++e;if(.5>e/b.length)return!1}else if(!E(a))return!1;return l.prototype.isValidValue.call(this,a)};q.prototype=new l;q.prototype.constructor=q;q.prototype.isValidValue=function(a){return E(a)?l.prototype.isValidValue.call(this,a):!1};m.prototype=new l;m.prototype.constructor=m;m.prototype.isValidValue=
function(a){return l.prototype.isValidValue.call(this,a)?0!=a.toLowerCase().indexOf("javascript:")&&"#"!=a:!1};p.prototype.generate=function(a){var b=L(a);if(!this.forceChildIndex){for(var e=0,c=a.nextSibling;null!=c;)1==c.nodeType&&c.tagName==a.tagName&&++e,c=c.nextSibling;if(0==b+e)return null}return"["+(b+1)+"]"};k.prototype.generate=function(a){if(0==L(a))return null;for(var b=a.nextSibling;null!=b;){if(1==b.nodeType&&b.tagName==a.tagName)return null;b=b.nextSibling}return"[last()]"};w.prototype.filterableByIndex=
!0;w.prototype.generate=function(a){for(var b=a.childNodes,e=b.length,c=0;c<e;++c)if(b[c]&&3!=b[c].nodeType)return null;a=a.textContent;return null!=a&&0<a.trim().length&&50>a.length?"[text()="+K(a)+"]":null};F.prototype.generate=function(a){for(var b=a.previousSibling;null!=b;){if(1==b.nodeType&&b.tagName==a.tagName)return null;b=b.previousSibling}for(b=a.nextSibling;null!=b;){if(1==b.nodeType&&b.tagName==a.tagName)return null;b=b.nextSibling}return""};B.prototype.generateAbsolute=function(a,b){for(var e=
new p(b),c="";null!=a;){if(1==a.nodeType){var d=e.generate(a);null==d&&(d="");c="/"+a.tagName.toLowerCase()+d+c}a=a.parentNode}return c};B.prototype.generate=function(a){for(var b=[],e=[""],c=a;null!=c&&0<e.length;){if(1==c.nodeType){for(var d=c,g=[],f=0;null!=d;){if(1==d.nodeType){var h=d.tagName.toLowerCase();if("body"==h)break;for(var l=0;l<this.selectorHints.length&&!(b.length>=this.maxPaths);++l){var m=this.selectorHints[l],k=m.generate(d);if(null!=k)for(var p=0;p<e.length&&!(b.length>=this.maxPaths);++p){var x=
e[p];if(!(0<f&&0==x.length||!m.filterableByIndex&&0<f&&0<x.length&&10<d.ownerDocument.getElementsByTagName(h).length)){var n=h+k+(0<f?"/":"")+x,t="//"+n,u=y(a.ownerDocument,t,0<f);if(1==u.length&&u[0]==a)b.push(t);else if(0==f){for(var t=!1,q=0;q<u.length;++q)if(a==u[q]){t=!0;break}if(t)if(m.filterableByIndex){for(var n=h,u=k,t=a,q=b,w=y(t.ownerDocument,"/descendant::"+n+u),z=0,A=0;A<w.length;++A){var v;a:{for(v=t;null!=v;){if(v==w[A]){v=!0;break a}v=v.parentNode}v=!1}if(v){z=A+1;break}}0<z&&(q.push("/descendant::"+
n+u+"["+z+"]"+x),z==w.snapshotLength&&q.push("/descendant::"+n+u+"[last()]"+x))}else g.push("/"+n)}}}}}d=d.parentNode;++f}e=g}c=c.parentNode}0==b.length&&b.push(this.generateAbsolute(a));return b};var M=function(){var a=null;return function(b){for(var e=[],c=0,d=b.length,g;c<d;++c)g=b.charCodeAt(c),128>g?e.push(g):2048>g?e.push(g>>6|192,g&63|128):e.push(g>>12|224,g>>6&63|128,g&63|128);b=-1;if(!a){for(var c=[],d=0,f;256>d;++d){f=d;for(g=8;g--;)f=1==(f&1)?f>>>1^3988292384:f>>>1;c[d]=f>>>0}a=c}c=a;d=
0;for(g=e.length;d<g;++d)f=(b^e[d])&255,b=b>>>8^c[f];return(b^-1)>>>0}}();return{save:function(){if(0<R().trim().length){rangy.init();var a=N(),b=JSON.stringify(a);d(function(){d.getScript("//tldrify.com/api/create.js?url="+encodeURIComponent(document.location.href)+"&data="+encodeURIComponent(b))})}else"undefined"!==typeof TLDR_spin&&TLDR_spin.hide()},restore:function(a,b,e,c,l,g){l||Q(a);try{rangy.init();"string"==typeof c&&(c=JSON.parse(c));var f=P(c),h="tldr-span"+(new Date).getTime();O(f,h)}finally{"undefined"!==
typeof TLDR_spin&&TLDR_spin.hide()}d(function(){d("."+h+":first").scrollTo();document.getSelection().removeAllRanges();var a=d("."+h),c=0==a.length;if(!c){var f=function(){d("#tldr-iframe").css({display:"none"})},m=function(a,c){a-=92.5;c+=10;0==d("#tldr-iframe").length?d("body").append(d("<iframe>").attr("id","tldr-iframe").attr("src","//tldrify.com/sharebox?v20140310-1720&url="+encodeURIComponent(b)+"&title="+encodeURIComponent(k)).attr("width",210).attr("height",115).attr("frameborder",0).css({position:"absolute",
overflow:"hidden","z-index":2147483647,top:c+"px",left:a+"px"})):d("#tldr-iframe").css({display:"",top:c+"px",left:a+"px"})},k=a.text(),k=d.trim(k).replace(/\s+/," ");100<k.length&&(k=k.substring(0,100).replace(/[\S]*$/,"..."));a.css({"background-color":"yellow",color:"#333",cursor:"pointer"});a.each(function(){0<d(this).parent("a").length&&d(this).css({"text-decoration":"underline"})});a.mouseenter(function(a){var b=a.clientX+d(window).scrollLeft();a=a.clientY+d(window).scrollTop();m(b,a)});d("body").on("click",
f);d(document).bind("keydown",function(a){27==a.which&&f()});if(l){var n=a.offset().left+a.width()/2,a=a.offset().top+a.height();m(n,a)}else m(-1E3,-1E3)}l||c&&!g||d.ajax({type:"POST",url:"//tldrify.com/api/citation/"+e+"/view",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({xpath_failure:c})})})}}}($TLDR);
