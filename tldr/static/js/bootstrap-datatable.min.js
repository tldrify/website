(function(c){function p(){var a=this.options;a.showPerPage&&r.call(this);a.filterModal&&s.call(this);a.toggleColumns&&t.call(this);a.allowOverflow&&u.call(this);a.allowTableinfo&&v.call(this);this.toolbar()}function t(){var a=this.options,b=c("<a></a>"),d=this;if(!this.$column_modal){var e=Math.floor(100*Math.random()+1);this.$column_modal=c("<div></div>").attr("id","dt-column-modal_"+e).attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","dt-column-modal-label_"+e).attr("aria-hidden",
"true").addClass("modal fade").hide();this.$column_modalheader=c("<div></div>").addClass("modal-header").append(c("<button></button>").addClass("close").data("dismiss","modal").attr("aria-hidden","true").html("&times;").click(function(){d.$column_modal.modal("hide")})).append(c("<h3></h3>").addClass("modal-title").attr("id","dt-column-modal-label_"+e).text("Toggle Columns"));this.$column_modalfooter=c("<div></div>").addClass("modal-footer").append(c('<div class="pull-left"></div>').append(c('<div class="btn-group"></div>').append(c("<button></button>").addClass("btn btn-info").append(c("<span></span>").addClass("glyphicon glyphicon-check").text("All")).click(function(){c(this).closest(".modal").find("button.on-off").each(function(){c(this).data("column-hidden")&&
c(this).click()});return!1}),c("<button></button>").addClass("btn btn-warning").append(c("<span></span>").addClass("glyphicon glyphicon-unchecked").text("None")).click(function(){c(this).closest(".modal").find("button.on-off").each(function(){c(this).data("column-hidden")||c(this).click()});return!1}))),a.allowSaveColumns?c("<button></button>").addClass("btn btn-primary").text("Save").click(function(){w.call(d);return!1}):"",c("<button></button>").addClass("btn btn-default").data("dismiss","modal").append(c("<span></span>")).text("Close").click(function(){d.$column_modal.modal("hide");
return!1}));this.$column_modalbody=c("<div></div>").addClass("modal-body");this.$column_modaldialog=c("<div></div>").addClass("modal-dialog").append(c("<div></div>").addClass("modal-content").append(this.$column_modalheader,this.$column_modalbody,this.$column_modalfooter));this.$column_modal.append(this.$column_modaldialog).appendTo(document.body)}b.addClass("btn").data("toggle","modal").data("content","Choose which columns you would like to display.").data("target","#"+this.$column_modal.attr("id")).attr("href",
"#"+this.$column_modal.attr("id")).append(c("<span></span>").addClass("glyphicon glyphicon-cog")).click(function(b){d.$column_modal.on("show.bs.modal",function(){a.debug&&console.log(d);x.call(d,d.$column_modalbody)}).modal();return!1}).popover({trigger:"hover",placement:"top"});this.buttons.unshift(b);a.debug&&console.log(b);return this.$column_modal}function s(){var a=this.options,b=c("<a></a>");b.addClass("btn").data("toggle","modal").attr("href","#").data("content","Open the filter dialog.").extend(c("<span></span>").addClass("glyphicon glyphicon-filter")).click(function(){c(a.filterModal).hasClass("modal")?
c(a.filterModal).modal():c(a.filterModal).is(":visible")?c(a.filterModal).hide():c(a.filterModal).show();return!1}).popover({trigger:"hover",placement:"top"});this.buttons.unshift(b)}function r(){var a=this.options,b=this,a=c("<a></a>").addClass("btn dropdown-toggle").data("content","Change the number of rows per page.").attr("data-toggle","dropdown").html(a.perPage+"&nbsp;").css({fontWeight:"normal"}).append(c("<span></span>").addClass("caret")).popover({trigger:"hover",placement:"top"});this.buttons.push(a);
a=c("<ul></ul>").addClass("dropdown-menu").css({fontSize:"initial",fontWeight:"normal"}).append(c('<li data-value="10"><a href="#">10</a></li>').click(function(){l.call(this,b);return!1}),c('<li data-value="20"><a href="#">20</a></li>').click(function(){l.call(this,b);return!1}),c('<li data-value="50"><a href="#">50</a></li>').click(function(){l.call(this,b);return!1}),c('<li data-value="100"><a href="#">100</a></li>').click(function(){l.call(this,b);return!1}),c('<li data-value="150"><a href="#">200</a></li>').click(function(){l.call(this,
b);return!1}));this.buttons.push(a)}function v(){var a=this.options,b=c("<a></a>");b.addClass("btn").attr("href","#").append(c("<span></span>").addClass("glyphicon glyphicon-info-sign")).click(function(){return!1});var d=[],e=[];c.each(a.sort,function(b,c){if(c.length){var e,g;for(g in a.columns)a.columns[g].field==c[0]&&(e=a.columns[g].title);d.push(e+" "+c[1].toUpperCase())}});c.each(a.filter,function(b,c){var d,g;for(g in a.columns)a.columns[g].field==b&&(d=a.columns[g].title);e.push((d||b)+" = '"+
c+"'")});c(b).data("content",c("<dl></dl>").append(0<d.length?'<dt><i class="icon-th-list"></i> Sort:</dt><dd>'+d.join(", ")+"</dd>":"",0<e.length?'<dt><i class="icon-filter"></i> Filter:</dt><dd>'+e.join(", ")+"</dd>":"")).popover({placement:"bottom"});this.buttons.unshift(b)}function u(){var a=this.$wrapper,b=c("<a></a>");b.addClass("btn").attr("href","#").attr("title","Toggle the size of the table to fit the data or to fit the screen.").append(c("<span></span>").addClass("glyphicon glyphicon-resize-full")).click(function(){a&&
("scroll"==a.css("overflow")?(c(this).children("span.glyphicon").attr("class","glyphicon glyphicon-resize-full"),a.css({overflow:"visible",width:"auto"})):(c(this).children("span.glyphicon").attr("class","glyphicon glyphicon-resize-small"),a.css({overflow:"scroll",width:a.width()})));return!1});this.resultset&&this.resultset.data&&0!=this.resultset.data.length||b.addClass("disabled");this.buttons.push(b)}function l(a){var b=a.options;b.perPage=c(this).data("value");for(var d=b.currentPage*b.perPage;d>
b.totalRows;)b.currentPage--,d=b.currentPage*b.perPage;1>b.currentPage&&(b.currentPage=1);c(this).popover&&c(this).popover("hide");a.render();return!1}function q(){var a=this.options,b=this.$element;b.empty();p.call(this);a.tableCallback&&"function"===typeof a.tableCallback&&a.tableCallback.call(this);this.loading(!1);this.$default&&b.append(this.$default.removeClass("hide"))}function x(a){var b=this.options,d=c("<form></form>").addClass("form-inline"),e=this,f;for(f in b.columns)if(""!==b.columns[f].title){var h=
c("<div></div>").addClass("form-group").append(c("<label></label>").addClass("control-label").append(b.columns[f].title,c("<button></button>").addClass("on-off btn "+(b.columns[f].hidden?"btn-info":"btn-warning")).data("column",f).data("column-hidden",b.columns[f].hidden).text(b.columns[f].hidden?"ON":"OFF").click(function(){var a=e.options,b=c(this).data("column"),d=c("."+a.columns[b].classname);d.is(":visible")?(d.hide(),a.columns[b].hidden=!0,c(this).removeClass("btn-warning").addClass("btn-info").text("ON").data("column-hidden",
!0)):(d.show(),a.columns[b].hidden=!1,c(this).removeClass("btn-info").addClass("btn-warning").text("OFF").data("column-hidden",!1));return!1})));d.append(h)}a.empty();a.append(d)}function w(){var a=this.options;localStorage&&(localStorage[this.localStorageId]=JSON.stringify(a.columns));c.ajax({url:a.url,type:"POST",dataType:"json",data:c.extend({},a.post,{action:"save-columns",columns:JSON.stringify(a.columns),sort:JSON.stringify(a.sort),filter:JSON.stringify(a.filter)}),success:function(b){a.debug&&
console.log("columns saved")}});this.$column_modal.modal("hide")}function y(a){var b=this.options;a=a?JSON.parse(a):[];var d=this.resultset;d.columns||(d.columns=[]);for(column in b.columns)b.columns[column]=c.extend({},b.columns[column],d.columns[column],a[column])}var n=function(a,b){this.$element=c(a);this.options=b;this.enabled=!0;this.columns=[];this.rows=[];this.buttons=[];this.localStorageId="datatable_"+(b.id||b.url.replace(/\W/ig,"_"));for(var d in this.options.columns)void 0===typeof this.options.columns[d].sortable&&
(this.options.columns[d].sortable=!0);this.$default=this.$element.children().length?this.$element.children():c("<div></div>").addClass("alert alert-error").html("No Results Found");this.$element.addClass("clearfix");localStorage&&(localStorage[this.localStorageId]="false");this.options.tablePreRender&&"function"===typeof this.options.tablePreRender&&this.options.tablePreRender.call(this);p.call(this);!0===this.options.autoLoad&&this.render()};n.prototype={constructor:n,render:function(){var a=this.options,
b=this.$element;this.loading(!0);this.columns=[];this.rows=[];this.buttons=[];this.$pagination=this.$footer=this.$body=this.$header=this.$table=this.$wrapper=void 0;this.$toolbar&&this.$toolbar.remove();this.$top_details=c("<div></div>").attr("id","dt-top-details");this.$bottom_details=c("<div></div>").attr("id","dt-bottom-details");var d=this;""!==a.url&&c.ajax({url:a.url,type:"GET",dataType:"json",data:c.extend({},a.post,{currentPage:a.currentPage,perPage:a.perPage,sort:a.sort,filter:a.filter}),
success:function(c){(d.resultset=c)&&void 0!==c&&c.data&&0!=c.data.length?(b.empty(),a.sort=c.sort,a.filter=c.filter,a.totalRows=c.totalRows,c.currentPage&&(a.currentPage=parseInt(c.currentPage)),y.call(d,localStorage[d.localStorageId]),b.append(d.table()),b.prepend(d.$top_details),b.append(d.$bottom_details),a.showHeader&&d.header(),a.showFooter&&d.footer(),d.body(),a.showTopPagination&&d.pagination()&&d.$top_details.append(d.pagination().clone(!0)),a.showPagination&&d.pagination()&&d.$bottom_details.append(d.pagination().clone(!0)),
d.details(),p.call(d),a.tableCallback&&"function"===typeof a.tableCallback&&a.tableCallback.call(d),d.loading(!1)):q.call(d)},error:function(b){a.debug&&console.log(b);q.call(d);d.loading(!1)}})},loading:function(a){var b=this.$element;this.$loading||(this.$loading=c("<div></div>").css({position:"absolute",top:parseInt(b.position().top)+5,left:parseInt(b.position().left)+parseInt(b.css("marginLeft"))+Math.floor(b.width()/4),width:Math.floor(b.width()/2)+"px"}).append(c("<div></div>").addClass("progress progress-striped active").append(c("<div></div>").addClass("progress-bar").attr("role",
"progressbar").css({width:"85%"}))).appendTo(document.body));a?b.css({opacity:0.2}):(b.css({opacity:1}),this.$loading.remove(),this.$loading=void 0)},toolbar:function(){var a=this.options,b=this.$element,d=this;this.$toolbar=c("<div></div>").addClass("dt-toolbar btn-toolbar pull-right");this.$button_group=c("<div></div>").addClass("btn-group").appendTo(this.$toolbar);for(var e=0;e<a.buttons.length;e++)this.buttons.push(a.buttons[e]);c.each(this.buttons,function(){d.$button_group.append(this)});a.sectionHeader?
(this.$section_header=c(a.sectionHeader),this.$section_header.append(this.$toolbar)):""===a.title||this.$section_header?(this.$toolbar_container||(this.$toolbar_container=c("<div></div>").addClass("dt-toolbar-container clearfix")),b.prepend(this.$toolbar_container.append(this.$toolbar))):(this.$section_header=c("<h2></h2>").text(a.title).append(this.$toolbar),b.before(this.$section_header));return this.$toolbar},details:function(){var a=this.options,b=0,d=0,b=a.currentPage*a.perPage-a.perPage+1;1>
b&&(b=1);d=a.currentPage*a.perPage;d>a.totalRows&&(d=a.totalRows);c('<div class="pull-left"><p>Showing '+b+" to "+d+" of "+a.totalRows+" rows</p></div>").prependTo(this.$bottom_details)},table:function(){var a=this.options;this.$table_wrapper||(this.$wrapper=c("<div></div>").addClass("dt-table-wrapper"));this.$table||(this.$table=c("<table></table>").addClass(a["class"]));this.$wrapper.append(this.$table);return this.$wrapper},header:function(){var a=this.options;if(!this.$header){this.$header=c("<thead></thead>");
var b=c("<tr></tr>"),d;for(d in a.columns){var e=this.column(d),f=e.data("column_properties");f.sortable&&!f.custom&&e.click(this,this.sort).css({cursor:"pointer"});for(var h=0;h<a.sort.length;h++)a.sort[h][0]==f.field&&("asc"==a.sort[h][1]?(e.append(c(a.ascending)),f.sortOrder="asc"):"desc"==a.sort[h][1]&&(e.append(c(a.descending)),f.sortOrder="desc"));b.append(e);this.$header.append(b);this.columns.push(e)}a.headerCallback&&"function"===typeof a.headerCallback&&a.headerCallback.call(this);this.$table.append(this.$header)}return this.$header},
footer:function(){var a=this.options;if(!this.$footer){this.$footer=c("<tfoot></tfoot>");for(column in a.columns){var b=c("<td></td>");b.data("cell_properties",a.columns[column]).addClass(a.columns[column].classname);this.$footer.append(b)}a.footerCallback&&"function"===typeof a.footerCallback&&a.footerCallback.call(this,this.resultset.footer);this.$table.append(this.$footer)}return this.$footer},body:function(){var a=this.resultset,b=this.options;if(!this.$body){this.$body=c("<tbody></tbody>");for(var d=
0;d<a.data.length;d++){var e=this.row(a.data[d]);this.$body.append(e);this.rows.push(e)}b.showFilterRow&&this.$body.prepend(this.filter());this.$table.append(this.$body)}return this.$body},filter:function(){var a=c("<tr></tr>"),b=this.options,d=this;a.addClass("dt-filter-row");for(var e in b.columns){var f=c("<td></td>").addClass(b.columns[e].classname);b.columns[e].hidden&&f.hide();b.columns[e].filter&&b.columns[e].field&&f.append(c("<input/>").attr("name","filter_"+b.columns[e].field).data("filter",
b.columns[e].field).val(b.filter[b.columns[e].field]||"").change(function(a){a=d.options;a.filter[c(this).data("filter")]=c(this).val();a.debug&&console.log(a.filter);d.render()}));a.append(f)}return a},row:function(a){var b=c("<tr></tr>"),d=this.options,e;for(e in d.columns){var f=this.cell(a,e);b.append(f)}d.rowCallback&&"function"===typeof d.rowCallback&&(b=d.rowCallback(b,a));return b},cell:function(a,b){var d=a[this.options.columns[b].field]||this.options.columns[b].custom,e=c("<td></td>"),f=
this.options;f.columns[b].callback&&"function"===typeof f.columns[b].callback&&(d=f.columns[b].callback.call(e,a,f.columns[b]));e.data("cell_properties",f.columns[b]).addClass(f.columns[b].classname).append(d||"&nbsp;");f.columns[b].css&&e.css(f.columns[b].css);f.columns[b].hidden&&e.hide();return e},column:function(a){var b=c("<th></th>"),d=this.options,e="dt-column_"+a+Math.floor(1E3*Math.random()+1);d.columns[a].classname=e;b.data("column_properties",d.columns[a]).addClass(e).text(d.columns[a].title);
d.columns[a].css&&b.css(d.columns[a].css);d.columns[a].hidden&&b.hide();return b},sort:function(a){var b=c(this).data("column_properties"),d=a.data;a=a.data.options;var e=!1;b.sortOrder=b.sortOrder?"asc"==b.sortOrder?"desc":"":"asc";if(a.allowMultipleSort){for(var f=0;f<a.sort.length;f++)a.sort[f][0]==b.field&&(a.sort[f][1]=b.sortOrder,""===b.sortOrder&&a.sort.splice(f,1),e=!0);e||a.sort.push([b.field,b.sortOrder])}else a.sort=[],a.sort.push([b.field,b.sortOrder]);a.debug&&console.log(a.sort);d.render()},
pagination:function(){var a=this,b=this.options,d=this.resultset;if(!(b.perPage>=d.totalRows)){if(!this.$pagination){this.$pagination=c("<div></div>").addClass("pull-right");b.pageCount=Math.ceil(d.totalRows/b.perPage);var d=c("<ul></ul>").addClass("pagination"),e=c("<li></li>").append(c("<a></a>").attr("href","#").data("page",1).html("&laquo;").click(function(){b.currentPage=1;a.render();return!1})),f=c("<li></li>").append(c("<a></a>").attr("href","#").data("page",b.currentPage-1).html("&lt;").click(function(){b.currentPage-=
1;b.currentPage=1<=b.currentPage?b.currentPage:1;a.render();return!1})),h=c("<li></li>").append(c("<a></a>").attr("href","#").data("page",b.currentPage+1).html("&gt;").click(function(){b.currentPage+=1;b.currentPage=b.currentPage<=b.pageCount?b.currentPage:b.pageCount;a.render();return!1})),l=c("<li></li>").append(c("<a></a>").attr("href","#").data("page",b.pageCount).html("&raquo;").click(function(){b.currentPage=b.pageCount;a.render();return!1})),g=2*b.pagePadding,k,m;g>=b.pageCount?(k=1,m=b.pageCount):
(k=b.currentPage-b.pagePadding,0>=k&&(k=1),m=k+g,m>b.pageCount&&(m=b.pageCount,k=m-g));for(g=k;g<=m;g++)k=c("<li></li>").append(c("<a></a>").attr("href","#").data("page",g).text(g).click(function(){b.currentPage=c(this).data("page");a.render();return!1})),g==b.currentPage&&k.addClass("active"),d.append(k);1==b.currentPage&&(e.addClass("disabled"),f.addClass("disabled"));b.currentPage==b.pageCount&&(h.addClass("disabled"),l.addClass("disabled"));d.prepend(e,f);d.append(h,l);this.$pagination.append(d)}return this.$pagination}},
remove:function(){var a=this.$element;this.$section_header&&this.$section_header.remove();a.data("datatable",null);a.empty()}};c.fn.datatable=function(a){c.fn.datatable.init.call(this,a,n,"datatable");return this};c.fn.datatable.init=function(a,b,d){var e;if(!0===a)return this.data(d);if("string"==typeof a){if(e=this.data(d))e[a]();return this}a=c.extend({},c.fn[d].defaults,a);this.each(function(){var e=c.data(this,d);e||(e=new b(this,c.fn.datatable.elementOptions(this,a)),c.data(this,d,e))});return this};
c.fn.datatable.DataTable=n;c.fn.datatable.elementOptions=function(a,b){return c.metadata?c.extend({},b,c(a).metadata()):b};c.fn.datatable.defaults={debug:!0,id:void 0,title:"Data Table Results","class":"table table-striped table-bordered",perPage:10,pagePadding:2,sort:[],filter:{},post:{},buttons:[],sectionHeader:void 0,totalRows:0,currentPage:1,showPagination:!0,showTopPagination:!1,showHeader:!0,showFooter:!1,showFilterRow:!1,filterModal:void 0,allowExport:!1,allowOverflow:!0,showPerPage:!0,allowMultipleSort:!1,
allowSaveColumns:!0,toggleColumns:!0,url:"",columns:[],ascending:c("<span></span>").addClass("glyphicon glyphicon-chevron-up"),descending:c("<span></span>").addClass("glyphicon glyphicon-chevron-down"),rowCallback:void 0,tableCallback:void 0,headerCallback:void 0,footerCallback:void 0,tablePreRender:void 0,autoLoad:!0}})(window.jQuery);
